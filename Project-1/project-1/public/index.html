<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <form action="http://localhost:3030/api/quotes" method="post" id="data-create-form">
        <div class="input-field-container">
            <input type="text" class="data-input-field" name="author" value="" placeholder="author">
        </div>
        <div class="input-field-container">
            <input type="text" class="data-input-field" name="description" value="" placeholder="description">
        </div>
        <div class="input-field-container">
            <input type="date" class="data-input-field" name="date" value="">
        </div>
        <div class="input-field-container">
            <input type="submit" value="Submit" id="submit-data-field">
        </div>
    </form>

    <!-- print data in table -->
    <table border="1" id="data-authors">
        <!-- It will be auto generated by JS -->
        <thead>
            <tr>
                <th>SN</th>
                <th>Author</th>
                <th>Description</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="print-quotes">

        </tbody>
    </table>

    <script>

        var table = document.getElementById('print-quotes');

        var containerLoader = document.createElement('div');
        containerLoader.className = "containerLoader";
        var loader = document.createElement('div');
        loader.className = "loader";
        containerLoader.appendChild(loader);
        table.appendChild(containerLoader);


        const getQuotes = async () => {
            const response = await fetch('http://localhost:3030/api/quotes');
            if (!response.ok) {
                throw new Error(`Response status: ${response.status}`);
            }
            quotes = await response.json();
            return quotes;
        }

        populateTable();

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }

        async function populateTable() {
            let quotes = await getQuotes();

            if (quotes && quotes.length >= 0) {
                table.removeChild(containerLoader);
            }
            quotes.forEach((quote, index) => {
                let row = document.createElement('tr');

                // SN column
                let idCell = document.createElement('td');
                idCell.textContent = index + 1;
                row.appendChild(idCell);

                // Author column
                const authorCell = document.createElement('td');
                authorCell.textContent = quote.author;
                row.appendChild(authorCell);

                // Description columnx
                const descCell = document.createElement('td');
                descCell.textContent = quote.description;
                row.appendChild(descCell);

                // Date column
                const dateCell = document.createElement('td');
                dateCell.textContent = formatDate(quote.dateTime);
                row.appendChild(dateCell);

                table.appendChild(row);
            })
            if (quotes.length == 0) {
                table.textContent = "No records"
            }
        }


    </script>
</body>

</html>